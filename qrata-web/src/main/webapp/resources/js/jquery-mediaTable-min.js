(function($){var __loop=function(cfg,i){var $this=$(this),wdg=$this.data("MediaTable");if(!$.isEmptyObject(wdg)){return;}wdg={$wrap:$("<div>"),$table:$this,$menu:false,cfg:cfg,id:$this.attr("id")};if(!wdg.id){wdg.id="MediaTable-"+i;wdg.$table.attr("id",wdg.id);}wdg.$table.addClass("activeMediaTable");wdg.$wrap.addClass("mediaTableWrapper");wdg.$table.before(wdg.$wrap).appendTo(wdg.$wrap);if(wdg.cfg.menu){__initMenu(wdg);}wdg.$table.find("thead th").each(function(i){__thInit.call(this,i,wdg);});wdg.$table.data("MediaTable",wdg);};var __initMenu=function(wdg){wdg.$menu=$("<div />");wdg.$menu.$header=$("<a />");wdg.$menu.$list=$("<ul />");wdg.$menu.addClass("mediaTableMenu").addClass("mediaTableMenuClosed").append(wdg.$menu.$header).append(wdg.$menu.$list);wdg.$wrap.addClass("mediaTableWrapperWithMenu");wdg.$menu.$header.text(wdg.cfg.menuTitle);wdg.$table.before(wdg.$menu);$(window).bind("orientationchange resize",function(){wdg.$menu.find("input").trigger("updateCheck");});wdg.$menu.$header.bind("click",function(){wdg.$menu.toggleClass("mediaTableMenuClosed");});wdg.$table.click(function(){wdg.$menu.addClass("mediaTableMenuClosed");});wdg.$menu.$list.bind("mouseleave",function(e){wdg.$menu.toggleClass("mediaTableMenuClosed");e.stopPropagation();});};var __thInit=function(i,wdg){var $th=$(this),id=$th.attr("id"),classes=$th.attr("class");if(!id){id=wdg.id+"-mediaTableCol-"+i;$th.attr("id",id);}if(wdg.cfg.menu&&!$th.is(".persist")){var $li=$('<li><input type="checkbox" name="toggle-cols" id="toggle-col-'+wdg.id+"-"+i+'" value="'+id+'" /> <label for="toggle-col-'+wdg.id+"-"+i+'">'+$th.text()+"</label></li>");wdg.$menu.$list.append($li);__liInitActions($th,$li.find("input"),wdg);}$("tbody tr",wdg.$table).each(function(){__trInit.call(this,i,id,classes);});};var __trInit=function(i,id,classes){var $cell=$(this).find("td,th").eq(i);$cell.attr("headers",id);if(classes){$cell.addClass(classes);}};var __liInitActions=function($th,$checkbox,wdg){var change=function(){var val=$checkbox.val(),cols=wdg.$table.find("#"+val+", [headers="+val+"]");if($checkbox.is(":checked")){cols.show();}else{cols.hide();}};var updateCheck=function(){if($th.is(":visible")){$checkbox.attr("checked",true);}else{$checkbox.attr("checked",false);}};$checkbox.bind("change",change).bind("updateCheck",updateCheck).trigger("updateCheck");};var __destroy=function(){var wdg=$(this).data("MediaTable");if(!wdg){return;}wdg.$wrap.after(wdg.$table).remove();wdg.$table.removeClass("activeMediaTable");wdg.$table.data("MediaTable",null);};$.fn.mediaTable=function(){var cfg=false;if(!arguments.length||$.isPlainObject(arguments[0])){cfg=$.extend({},{menu:true,menuTitle:"Display",t:"e"},arguments[0]);}if(cfg!==false){$(this).each(function(i){__loop.call(this,cfg,i);});}else{if(arguments.length){switch(arguments[0]){case"destroy":$(this).each(function(){__destroy.call(this);});break;}}}return this;};})(jQuery);